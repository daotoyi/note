(window.webpackJsonp=window.webpackJsonp||[]).push([[167],{648:function(s,t,n){"use strict";n.r(t);var e=n(20),a=Object(e.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("p",[s._v("Linux_chroot_SSHlogin")]),s._v(" "),n("p",[s._v("[toc]")]),s._v(" "),n("h1",{attrs:{id:"chroot"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#chroot"}},[s._v("#")]),s._v(" chroot")]),s._v(" "),n("p",[s._v("github："),n("a",{attrs:{href:"http://huiliu.github.io/2016/01/19/jail.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("如何让特定用户通过SSH登陆后自动chroot"),n("OutboundLink")],1)]),s._v(" "),n("p",[s._v("linux："),n("a",{attrs:{href:"https://linux.cn/article-8313-1.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("测试 sftp 的  chroot 监狱"),n("OutboundLink")],1)]),s._v(" "),n("p",[s._v("archlinux：Chroot (简体中文)")]),s._v(" "),n("h2",{attrs:{id:"steps"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#steps"}},[s._v("#")]),s._v(" steps")]),s._v(" "),n("p",[s._v("属于该组的用户通过ssh登陆系统时将被自动chroot。")]),s._v(" "),n("ul",[n("li",[s._v("创建chroot用户组")])]),s._v(" "),n("blockquote",[n("p",[s._v("groupadd chrootjail\nor\naddgroup chrootjail")])]),s._v(" "),n("ul",[n("li",[n("p",[s._v("添加用户到chrootjail组中\nsudo adduser tester chrootjail")])]),s._v(" "),n("li",[n("p",[s._v("配置sshd\n在sshd的配置文件"),n("code",[s._v("/etc/ssh/sshd_config")]),s._v("中添加:")]),s._v(" "),n("ol",[n("li",[s._v("用户组group")])])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("Match group chrootjail\n   ChrootDirectory /var/chroot/\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[s._v("\t2.用户user\n")])])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("Match User tecmint\n\tChrootDirectory /var/chroot\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("ul",[n("li",[s._v("重启sshd服务")])]),s._v(" "),n("blockquote",[n("p",[s._v("service ssh restart\nor\nsystemd restart systemd-networkd")])]),s._v(" "),n("ul",[n("li",[s._v("配置sftp\n在 "),n("code",[s._v("/etc/ssh/sshd_config")]),s._v(" 中添加：")])]),s._v(" "),n("blockquote",[n("p",[s._v("ForceCommand internal-sftp")])]),s._v(" "),n("p",[s._v("重启服务")]),s._v(" "),n("blockquote",[n("p",[s._v("#systemctl restart sshd")])]),s._v(" "),n("p",[s._v("使用ssh连接会报错")]),s._v(" "),n("blockquote",[n("p",[n("a",{attrs:{href:""}},[s._v("e568278386a1863c14c0731d26fe8660.png")])])]),s._v(" "),n("ul",[n("li",[s._v("note:")])]),s._v(" "),n("ol",[n("li",[n("p",[s._v("当用户登陆到chroot环境中，其home目录不存在时，它的当前工作目录为“/”.")])]),s._v(" "),n("li",[n("p",[s._v("创建 chroot 监狱通用配置目录 /home/test/etc 并复制已更新的账号文件（/etc/passwd 和 /etc/group）到这个目录中.")])]),s._v(" "),n("li",[n("p",[s._v("每次向系统添加更多 SSH 用户时，都需要将更新的帐户文件复制到 /var/chroot/etc 目录中.")])])]),s._v(" "),n("ul",[n("li",[s._v("附:shell脚本来完成chroot基本功能的的环境准备")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("#!/bin/bash\n# This script can be used to create simple chroot environment\n# Written by LinuxCareer.com <http://linuxcareer.com/>\n# (c) 2013 LinuxCareer under GNU GPL v3.0+\n\n#!/bin/bash\n\nCHROOT='/home/jail'\nmkdir $CHROOT\n\nfor i in $( ldd $* | grep -v dynamic | cut -d \" \" -f 3 | sed 's/://' | sort | uniq )\n  do\n    cp --parents $i $CHROOT\n  done\n\n# ARCH amd64\nif [ -f /lib64/ld-linux-x86-64.so.2 ]; then\n   cp --parents /lib64/ld-linux-x86-64.so.2 /$CHROOT\nfi\n\n# ARCH i386\nif [ -f  /lib/ld-linux.so.2 ]; then\n   cp --parents /lib/ld-linux.so.2 /$CHROOT\nfi\n\necho \"Chroot jail is ready. To access it execute: chroot $CHROOT\"\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br")])])])}),[],!1,null,null,null);t.default=a.exports}}]);