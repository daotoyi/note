(window.webpackJsonp=window.webpackJsonp||[]).push([[94],{574:function(t,o,r){"use strict";r.r(o);var e=r(20),s=Object(e.a)({},(function(){var t=this,o=t.$createElement,r=t._self._c||o;return r("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[r("p",[t._v("Linux_chroot_RecoveryPass")]),t._v(" "),r("p",[t._v("[toc]")]),t._v(" "),r("p",[t._v("imooc:"),r("a",{attrs:{href:"http://www.imooc.com/article/26318",target:"_blank",rel:"noopener noreferrer"}},[t._v("通过 chroot 重新设置 root 密码"),r("OutboundLink")],1)]),t._v(" "),r("h2",{attrs:{id:"instruction"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#instruction"}},[t._v("#")]),t._v(" instruction")]),t._v(" "),r("p",[t._v("systemd 的管理机制中，rescure 模式和 emeryency 模式是无法直接取得 root 权限的，需要使用 root 密码才能进入 rescure 和 emeryency 环境。所以我们需要通过其他方式来设置 root 密码。")]),t._v(" "),r("p",[t._v('可以为内核的启动指定 "rd.break" 参数，从而让系统在启动的早期停下来，此时可以通过使用 root 权限并结合 chroot 命令完成设置 root 密码的操作。')]),t._v(" "),r("h2",{attrs:{id:"step"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#step"}},[t._v("#")]),t._v(" step")]),t._v(" "),r("h3",{attrs:{id:"bootloadr"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#bootloadr"}},[t._v("#")]),t._v(" bootloadr")]),t._v(" "),r("ul",[r("li",[r("p",[t._v("在系统启动过程中进入开机菜单时按下字母键 e 进程开机菜单的编辑模式.")])]),t._v(" "),r("li",[r("p",[t._v('找到以 "linux16 /vmlinuz-" 开头的行,定位到该行结尾处，输入一个空格和字符串 "rd.break".')])]),t._v(" "),r("li",[r("p",[t._v("按下 ctrl + x 以该设置继续启动，启动过程中操作系统会停下来.\n此时系统的根目录还挂载在 RAM disk 上(内存中的一个文件系统)，可以通过 mount 命令检查系统当前挂载的文件系统。")]),t._v(" "),r("ul",[r("li",[t._v("第一行说明此时的根目录在一个 RAM disk 中, 即 rootfs。")]),t._v(" "),r("li",[t._v("第二行说明我们的文件系统此时被挂载到了 /sysroot 目录，并且是"),r("strong",[t._v("只读")]),t._v("的模式.")])])])]),t._v(" "),r("h3",{attrs:{id:"remount"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#remount"}},[t._v("#")]),t._v(" remount")]),t._v(" "),r("ul",[r("li",[t._v("把 /sysroot 重新挂载为可读写的模式")])]),t._v(" "),r("blockquote",[r("p",[t._v("switch_root:/# mount -o remount,rw /sysroot")])]),t._v(" "),r("ul",[r("li",[t._v("chroot 命令把根目录切换到原来的环境中")])]),t._v(" "),r("blockquote",[r("p",[t._v("switch_root:/# chroot /sysroot")])]),t._v(" "),r("p",[r("u",[t._v("此时可以理解为：我们以 root 权限登录了原来的系统")])]),t._v(" "),r("h3",{attrs:{id:"recovery"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#recovery"}},[t._v("#")]),t._v(" recovery")]),t._v(" "),r("ul",[r("li",[t._v("为 root 用户设置新的密码")])]),t._v(" "),r("blockquote",[r("p",[t._v('#echo "new_root_pw" | passwd --stdin root')])]),t._v(" "),r("h3",{attrs:{id:"selinux"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#selinux"}},[t._v("#")]),t._v(" selinux")]),t._v(" "),r("ul",[r("li",[t._v("处理 SELinux 相关的问题\n由于当前的环境中 SELinux 并未启动，所以我们对文件的修改可能造成文件的 context 不正确。\n为了确保开机时重新设定 SELinux context，必須在根目录下添加隐藏文件 .autorelabel")])]),t._v(" "),r("blockquote",[r("p",[t._v("#touch /.autorelabel")])]),t._v(" "),r("ul",[r("li",[t._v("从 chroot 中退出，并重启系统")])]),t._v(" "),r("blockquote",[r("p",[t._v("sh-4.2#exit\nswitch_root:/# reboot")])])])}),[],!1,null,null,null);o.default=s.exports}}]);